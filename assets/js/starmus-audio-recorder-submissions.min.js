document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll("[data-enabled-recorder]");0!==e.length&&e.forEach((e=>{const t=e.id;if(!t||!t.startsWith("starmus_audioWrapper_"))return;const a=t.substring(21),r=document.getElementById(a),s=document.getElementById(`sparxstar_status_${a}`),o=s?s.querySelector(".sparxstar_status__text"):null,d=document.getElementById(`sparxstar_loader_${a}`),n=(d&&d.querySelector(".sparxstar_status__text"),document.getElementById(`audio_uuid_${a}`)),u=document.getElementById(`submit_button_${a}`);function _updateStatusForInstance(e,t,a="info",r=!0,s=null){const o=document.getElementById(`sparxstar_status_${e}`),d=o?o.querySelector(".sparxstar_status__text"):null;d&&(d.textContent=t,d.className="sparxstar_status__text",a&&d.classList.add(a)),o&&r&&o.classList.remove("sparxstar_visually_hidden"),s&&(s.disabled=!1)}r&&("undefined"!=typeof StarmusAudioRecorder&&StarmusAudioRecorder.init?StarmusAudioRecorder.init({formInstanceId:a,buildHash:"66b1d653d14e7c7f31fe6b00158f7cdf6eb3cd6e9b6e8ca97e6271430253fc00",recorderContainerSelector:`#starmus_audioWrapper_${a}`}).then((e=>{e||(o&&(o.textContent="Recorder failed to load."),s&&s.classList.remove("sparxstar_visually_hidden"))})).catch((e=>{o&&(o.textContent="Error loading recorder."),s&&s.classList.remove("sparxstar_visually_hidden")})):(o&&(o.textContent="Critical error: Recorder unavailable."),s&&s.classList.remove("sparxstar_visually_hidden")),e.addEventListener("starmusAudioReady",(e=>{if(e.detail&&e.detail.audioId){document.cookie=`audio_uuid=${n.value}; path=/; SameSite=Lax; Secure`;let t="Recording ready. ";if(e.detail.durationMs&&e.detail.durationMs>6e4){t+=`Your recording is about ${Math.floor(e.detail.durationMs/6e4)} min long and may take some time to upload. `}t+="Please submit when ready.",_updateStatusForInstance(a,t,"info"),s&&s.classList.remove("sparxstar_visually_hidden")}})),r.addEventListener("submit",(async e=>{if(e.preventDefault(),!n||!n.value)return void _updateStatusForInstance(a,"Error: Audio not recorded or Audio ID missing.","error");const t=document.getElementById(`audio_file_${a}`);if(!t||0===t.files.length)return void _updateStatusForInstance(a,"Error: No audio file data to submit.","error");const o=document.getElementById(`audio_consent_${a}`);if(o&&!o.checked)return void _updateStatusForInstance(a,"Error: Consent is required.","error");if(u&&(u.disabled=!0),d){const e=d.querySelector(".sparxstar_status__text");e&&(e.textContent="Submitting your recordingâ€¦"),d.classList.remove("sparxstar_visually_hidden")}s&&s.classList.add("sparxstar_visually_hidden");const i=new FormData(r);let c="--- FormData before submission ---\n";for(let[a,r]of i.entries())c+=a+": "+(r instanceof File?r.name:r)+"\n";let l=document.getElementById("debug_output");l||(l=document.createElement("pre"),l.id="debug_output",l.style="background:#eee;color:#222;font-size:12px;padding:8px;overflow:auto;max-height:200px;",document.body.appendChild(l)),l.textContent=c;const m="undefined"!=typeof starmusFormData&&starmusFormData.ajax_url?starmusFormData.ajax_url:"/wp-admin/admin-ajax.php";try{const e=await fetch(m,{method:"POST",body:i});let t;try{t=await e.json()}catch(_){await e.text();return _updateStatusForInstance(a,`Error: Invalid server response. (${e.status})`,"error",!0,u),void(d&&d.classList.add("sparxstar_visually_hidden"))}if(d&&d.classList.add("sparxstar_visually_hidden"),e.ok&&t.success)_updateStatusForInstance(a,t.message||"Successfully submitted!","success",!0),r.reset(),"undefined"!=typeof StarmusAudioRecorder&&StarmusAudioRecorder.cleanup&&StarmusAudioRecorder.cleanup(),"function"==typeof window.onStarmusSubmitSuccess&&window.onStarmusSubmitSuccess(a,t);else{const e=t.data?.message||t.message||"Unknown server error.";_updateStatusForInstance(a,`Error: ${e}`,"error",!0,u)}}catch(p){d&&d.classList.add("sparxstar_visually_hidden"),_updateStatusForInstance(a,"Network error. Please check connection and try again.","error",!0,u)}})))}))}));
//# sourceMappingURL=starmus-audio-recorder-module.min.js.map